var Cookie=(function(){return{createCookie:function(c,d,e){if(e){var b=new Date();b.setTime(b.getTime()+(e*24*60*60*1000));var a="; expires="+b.toGMTString()}else{var a=""}document.cookie=c+"="+d+a+"; path=/"},readCookie:function(b){var e=b+"=";var a=document.cookie.split(";");for(var d=0;d<a.length;d++){var f=a[d];while(f.charAt(0)==" "){f=f.substring(1,f.length)}if(f.indexOf(e)==0){return f.substring(e.length,f.length)}}return null},eraseCookie:function(a){Cookie.createCookie(a,"",-1)}}})();var Config=(function(f){var d=function(g){var h=new RegExp("/login$");return h.test(g)};var e=function(l,j){var i=l.redirection;var m=i.indexOf("?");var k=i.indexOf(";");var h=m>0?(k>0?Math.min(m,k):m):(k>0?k:m);if(h>0){i=i.substring(0,h)}var g=i.indexOf("://");if(i.indexOf("://")>0){i=window.location.protocol+i.substring(g+1)}else{if(i.indexOf(base)>-1){i=window.location.protocol+"//"+(window.location.hostname+":"+window.location.port+"/"+i).replace(new RegExp("//","gm"),"/")}else{i=window.location.protocol+"//"+(window.location.hostname+":"+window.location.port+"/"+base+"/"+i).replace(new RegExp("//","gm"),"/")}}if(d(i)){i+="?forward=/login/ajaxforward";ModalBox.dialog({message:'<iframe style="border:0;" src="'+i+'" height="380" width="100%"></iframe>',title:"用户登录",onEscape:function(n){if(CURRENTUSER==n.user){setTimeout(function(){f.ajax(j)},100)}else{window.location.reload()}}});ModalBox.closeDialog=function(n){f(".bootbox").trigger({type:"escape.close.bb",user:n})}}else{ModalBox.alert("地址已转移: "+l.redirection)}};var a=function(g){ModalBox.alert(g.errorMessage+": "+g.exceptionMessage)};var c=function(g){ModalBox.alert(g.errorMessage+": "+g.exceptionMessage)};var b=function(g){if(g.exceptionMessage.indexOf("reload")>-1||g.exceptionMessage.indexOf("加载")>-1||g.exceptionMessage.indexOf("加載")>-1){ModalBox.alert(g.exceptionMessage,function(){window.location=base})}else{ModalBox.alert(g.errorMessage+": "+g.exceptionMessage)}};return{$header:f("#header"),$main:f("#main"),$mainMenu:f("#main-menu"),$mainBreadCrumb:f("#main-breadcrumb"),$mainContent:f("#main-content"),$footer:f("#footer"),onAjaxResponseError:function(k,j,h,g){var i=j.exceptionCode||k;switch(i){case"http.301":case"http.302":case 301:case 302:e(j,h);break;case"http.403":case 403:a(j);break;case"http.404":case 404:c(j);break;case"http.500":case 500:b(j);break;default:if(j.redirection){e(j,h)}else{if(j.exceptionMessage){if(j.exceptionMessage=="timeout"){ModalBox.alert("请求超时，请重试！")}else{if(j.exceptionMessage!="abort"){ModalBox.alert(j.exceptionMessage)}}}else{if(j.exceptionStack){ModalBox.dialog({title:"严重错误",message:'<div style="width:100%;height:200px;scroll: auto">'+j.exceptionStack+"</div>",buttons:{ok:{label:"确定"}}})}}}break}},getAbsoluteUrl:function(i,h){if(i.indexOf("://")>=0){return i}if(i.charAt(0)!="/"){i="/"+i}var g=(h||base);return i.startWith(g)?i:g+i}}}(jQuery));$(document).ready(function(){$.ajaxSetup({cache:false,timeout:60000,contentType:"application/x-www-form-urlencoded; charset=UTF-8",headers:{MU:CURRENTUSER}});$(document).ajaxError(function(h,i,f,d){var g=null,a=d;try{g=$.parseJSON(i.responseText)}catch(h){a=h}if(a!=null&&g==null){var c=null;if(typeof a=="string"){c=a}else{c=a.message}if(c!=null){g={errorMessage:"",exceptionMessage:c}}}if(i.status||g){Config.onAjaxResponseError(i.status,g,f||{},a)}});ModalBox.setDefaults({locale:"zh_CN"});if(Cookie.readCookie("current-skin-admin")){var b=document.createElement("link");b.href=Cookie.readCookie("current-skin-admin");b.rel="stylesheet";document.getElementsByTagName("head")[0].appendChild(b)}});