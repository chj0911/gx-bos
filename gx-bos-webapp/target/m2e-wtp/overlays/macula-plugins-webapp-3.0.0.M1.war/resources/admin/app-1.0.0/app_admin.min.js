$(function(){$.ajaxSetup({cache:false,timeout:60000,contentType:"application/x-www-form-urlencoded; charset=UTF-8",headers:{MU:CURRENTUSER}});$(document).ajaxError(function(g,h,d,c){var f=null,a=c;try{f=$.parseJSON(h.responseText)}catch(g){a=g}if(a!=null&&f==null){var b=null;if(typeof a=="string"){b=a}else{b=a.message}if(b!=null){f={errorMessage:"",exceptionMessage:b}}}if(h.status||f){onAjaxResponseError(h.status,f,d||{},a)}})});function onAjaxResponseError(f,e,b,a){var d=e.exceptionCode||f;switch(d){case"http.301":case"http.302":case 301:case 302:onAjaxRedirect(e,b);break;case"http.403":case 403:onAjaxForbidden(e,b);break;case"http.404":case 404:onAjaxNotFound(e,b);break;case"http.500":case 500:onAjaxServerError(e,b);break;default:if(e.redirection){onAjaxRedirect(e,b)}else{if(e.exceptionMessage){if(e.exceptionMessage=="timeout"){alert("请求超时，请重试！")}else{if(e.exceptionMessage!="abort"){MessageBox.error(e.exceptionMessage)}}}else{if(e.exceptionStack){new $.dialog({title:"严重错误",html:'<div style="width:522px;height:400px;scroll: auto">'+e.exceptionStack+"</div>",cover:true,autoSize:false,rang:true,btnBar:false,iconTitle:false,link:true,width:522,height:422}).ShowDialog()}}}break}}function isLoginUrl(a){var b=new RegExp("/login$");return b.test(a)}var loginDialog=null;function onAjaxRedirect(f,d){var c=f.redirection;var g=c.indexOf("?");var e=c.indexOf(";");var b=g>0?(e>0?Math.min(g,e):g):(e>0?e:g);if(b>0){c=c.substring(0,b)}var a=c.indexOf("://");if(c.indexOf("://")>0){c=window.location.protocol+c.substring(a+1)}else{if(c.indexOf(base)>-1){c=window.location.protocol+"//"+(window.location.hostname+":"+window.location.port+"/"+c).replace(new RegExp("//","gm"),"/")}else{c=window.location.protocol+"//"+(window.location.hostname+":"+window.location.port+"/"+base+"/"+c).replace(new RegExp("//","gm"),"/")}}if(isLoginUrl(c)){c+="?forward=/admin/ajaxforward";loginDialog=new $.dialog({title:"用户登录",page:c,cover:true,autoSize:true,rang:true,btnBar:false,iconTitle:false,link:true,width:620,height:425});loginDialog.closeDialog=function(h){if(CURRENTUSER==h){loginDialog.closeTime(0.5,function(){setTimeout(function(){mAjax(d)},100)})}else{window.location.reload()}};loginDialog.ShowDialog()}else{alert("地址已转移: "+f.redirection)}}function onAjaxForbidden(b,a){alert(b.errorMessage+": "+b.exceptionMessage)}function onAjaxNotFound(b,a){alert(b.errorMessage+": "+b.exceptionMessage)}function onAjaxServerError(a){if(a.exceptionMessage.indexOf("reload")>-1||a.exceptionMessage.indexOf("加载")>-1||a.exceptionMessage.indexOf("加載")>-1){alert(a.exceptionMessage);window.location=base}else{alert(a.errorMessage+": "+a.exceptionMessage)}};