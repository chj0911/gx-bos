(function(a,b){a.fn.maculamenu=function(e){var p=a.extend({url:b,dataType:"json",topMenuTmpl:a.template(null,'<dl><dt><a mid="${id}" target="menu" class="wg"><span>${name}</span></a></dt><dd><ul>{{each(index2, menu2) children}}<li><a class="head-nav-sub" href="javascript:void(0)"><span>${menu2.name}</span></a><ul>{{each(index3, menu3) menu2.children}}<li><a mid="${menu3.id}" url="${menu3.uri}" target="menu::{openMode:\'{{if menu3.attributes.openMode}}${menu3.attributes.openMode}{{else}}normal{{/if}}\'}" href="javascript:void(0);">${menu3.name}</a></li>{{/each}}</ul></li>{{/each}}</ul></dd></dl>'),leftMenuTmpl:a.template(null,'<div class="side-bx first"><div class="side-bx-title"><h3>${name}</h3></div><div class="side-bx-bd"><ul>{{each(index2, menu2) children}}<li><a mid="${menu2.id}" url="${menu2.uri}" target="menu::{openMode:\'{{if menu2.attributes.openMode}}${menu2.attributes.openMode}{{else}}normal{{/if}}\'}" href="javascript:void(0);">${menu2.name}</a></li>{{/each}}</ul></div></div>'),left_menu:b},e||{});var m=this,h=a(this),n,f,k;var j=function(){if(n&&n>0){var o=h.find("a[mid="+n+"]");return o.closest("dl").find("a.wg:first")}return a()};var i=function(){h.empty();var q=[];var o=[];for(var r=0;r<f.length;r++){a.tmpl(p.topMenuTmpl,f[r].children).appendTo(h)}h.find("dl").each(function(){var s=a(this).find("a:first"),t=a(this).find("a[url]:first");if(t.length){s.attr("_mid",t.attr("mid")).attr("url",t.attr("url")).attr("href",t.attr("href"))}a(this).find("dd>ul>li:last").addClass("last")})};var l=function(){var o=h.find("dl");o.hover(function(){k=true;j().removeClass("current");a(this).find(".wg").addClass("current");var q=a(this).find("dd");if(q.exists()){q.bgiframe({width:q[0].offsetWidth,height:q[0].offsetHeight}).showme().css(g(a(this),q))}},function(){if(k){a(this).find(".wg").removeClass("current");j().addClass("current");var q=a(this).find("dd");if(q.exists()){q.hideme()}}}).click(function(r){k=true;var q=a(this);setTimeout(function(){q.trigger("mouseleave")},300)})};var d=function(){var o=a(p.left_menu);a(o.selector+" .side-bx-title").live("click",function(r){r.preventDefault();r.stopPropagation();var s=a(this).parent(),q=a(this).next(".side-bx-bd");if(s.hasClass("side-bx-toggled")){q.showme();s.removeClass("side-bx-toggled")}else{q.hideme();s.addClass("side-bx-toggled")}})};var c=function(q){function o(u){for(var t=0;t<f.length;t++){var s=f[t].children;for(var t=0;t<s.length;t++){if(s[t].id==u){return s[t]}}}}var r=o(q);a.tmpl(p.leftMenuTmpl,r.children).appendTo(a(p.left_menu));a(p.left_menu).find(">div:first").addClass("first");a(p.left_menu).find(">div:last").addClass("last")};var g=function(r,o){var u=r.position().left,v=r.position().top,s=u+r.width();var q=o.width(),t=a(window).width();if(u+q<t||q>s){return{left:u,top:v+r.height()}}else{return{left:s-o.outerWidth(true),top:v+r.height()}}};m.updatemenu=function(q){n=q;h.find("a.wg").removeClass("current");var u=j().addClass("current").attr("mid");if(p.left_menu){var o=a(p.left_menu);a(p.left_toggle).removeClass("fixed hide");var r=o.empty().parents(".side");if(!q||q<=0||!u){if(!r.hasClass("hide")){r.addClass("hide")}return}var v="desktop_"+CURRENTUSER+"_sideleft";var t=!a.cookie(v);if(t){r.removeClass("hide")}a(p.left_toggle).trigger("onLeftTogglerChange");if(o.find("a[mid="+q+"]").exists()){return}c(u);var s=o.find("a[mid="+q+"]");if(!s.hasClass("current")){s.addClass("current")}}a(window).trigger("resize")};if(!!p.url){mAjax({url:p.url,success:function(o){f=o.makeLevelTree({pid:"parentId",order:function(q){return q.attributes["ordered"]}});i();h.find("dl ul li li").sameWidth().click(function(){a(this).parent("dl").trigger("mouseleave");k=false});l();d();PageContext.page_top_menu_loaded=true},dataType:p.dataType,type:"GET"})}}})(jQuery);