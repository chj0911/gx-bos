var closeFindUserRule=function(){var f=$("#myUserRuleTable"),q;var m=$("#findUserRuleId").val(),c=$("#findUserRuleType").val(),j=$("#findUserRuleParentTableId").val();var g=$("#userRule_multiselect_to option");if(!g||g.length==0){ModalBox.alert("请选择一条数据");return}var s=new Array();var k=new Array();for(var h=0;h<g.length;h++){s.push(g[h].value);k.push($(g[h]).attr("ruleCode"))}var d=base+"/admin";if(c=="plan"){d=d+"/studycenter/"+c+"/saveUserRule";if(oldUser!=null&&oldUser!=""){q={relationIds:s,id:m,olds:oldUser,codes:k}}else{q={relationIds:s,id:m,codes:k}}}else{if(c=="courseShare"){d=d+"/coursecenter/coursemanager/course-user/save";var r=$("#list-course-list").DataTable().selectedRows();var b=new Array();for(var h=0;h<r.length;h++){if(r[h].terminal!=1&&r[h].shareStatus=="未分享"){b.push(r[h].id)}}q={userRuleIds:s,ids:b,codes:k}}else{if(c=="share"){d=d+"/coursecenter/coursemanager/course-user/save";var b=new Array();b.push(m);q={userRuleIds:s,ids:b,codes:k}}else{if(c=="train"){d=d+"/signUp/train/addUserRule";q={ruleIds:s,trainId:m,codes:k}}else{if(c=="honor"){d=d+"/pcbackground/honorroll/addUserRule";q={ruleIds:s,honorId:m,codes:k}}else{if(c=="message"){for(var h=0;h<g.length;h++){var p=$("#addressee-rule-"+g[h].value);if(p==undefined||p==""||p.length<1){document.getElementById("addresseeUl").innerHTML+='<li class="search-choice" id="addressee-rule-'+g[h].value+'" addressee="'+$(g[h]).attr("ruleCode")+'" aname="'+g[h].text+'" atype="USERRULE"><span>'+g[h].text+'</span><a class="search-choice-close" onclick="$(this).parent().remove();"></a></li>'}}$("#findUserRule").modal("hide");return}else{if(c=="createdSurvey"){var a=$("#createdSurvey_userRuleIds").val();for(var h=0;h<g.length;h++){if(a&&a.length>0){a+=","+g[h].value}else{if(h==0){a=g[h].value}else{a+=","+g[h].value}}}$("#createdSurvey_userRuleIds").val(a);$("#findUserRule").modal("hide");if(j){var l=$("#table-list-user-rule-add-item").attr("data-ajax-url");if(l==undefined){l=$("#table-list-user-rule-edit-item").attr("data-ajax-url")}var e=l.split("?");if(e.length>1){l=e[0]+"?ids="+a}$("#"+j).DataTable().ajax.url(l).load()}return}else{if(c=="exam"){d=d+"/exam/examInfo/saveUserGroup";var a=new Array();for(var h=0;h<g.length;h++){a.push(g[h].value)}q={id:m,ids:a,codes:k};var n=base+"/admin/exam/examInfo/findUserRule?id="+m;$.ajax({type:"post",url:d,data:JSON.stringify(q),dataType:"json",contentType:"application/json;charset=utf-8",success:function(i){$("#findUserRule").modal("hide");if(j){$("#"+j).DataTable().ajax.url(n).load()}}});return}}}}}}}}if(c=="category"){d=d+"/infocenter/"+c+"/saveUserRule";q={relationIds:s,id:m,codes:k}}$.ajax({type:"post",url:d,data:JSON.stringify(q),dataType:"json",contentType:"application/json;charset=utf-8",success:function(i){$("#findUserRule").modal("hide");if(j){$("#div-"+j).show();$("#"+j).DataTable().ajax.reload()}}})};$(function(){var c=[];var b=$("#findUserRuleType").val();var a=$("#myUserRuleTable");$("#findUserRule_search").click(function(){var h=$("#userRule_multiselect_to option");var e=new Array();var d=new Array();if(h&&h.length>0){for(var g=0;g<h.length;g++){e.push(h[g].value);d.push($(h[g]).attr("ruleCode"))}}var f=base+"/admin/usercenter/rule/userrule/search";var j={relationType:b,relationId:$("#findUserRuleId").val(),selectedList:e,queryThing:$("#findUserRule_name").val(),codes:d};$.ajax({type:"post",url:f,data:JSON.stringify(j),dataType:"json",contentType:"application/json;charset=utf-8",success:function(k){$("#userRule_multiselect").empty();var m=$("#userRule_multiselect");var n="";for(var l=0;l<=k.content.length-1;l++){n+="<option value='"+k.content[l].id+"' ruleCode='"+k.content[l].code+"'>"+k.content[l].name+"</option>"}m.append(n)}})});$("#findUserRule_name").keydown(function(f){var d=f||window.event;if(d.keyCode==13||d.which==13){$("#findUserRule_search").trigger("click");$("input").blur()}});$("#findUserRule").on("show.bs.modal",function(){$("#userRule_multiselect").empty();$("#userRule_multiselect_to").empty();$("#findUserRule_name").val("");var f=base+"/admin/usercenter/rule/userrule/search";var e=$("#userRule_multiselect_to option");var d=new Array();if(e&&e.length>0){for(var g=0;g<e.length;g++){d.push(e[g].value)}}var h={relationType:b,relationId:$("#findUserRuleId").val(),selectedList:d,queryThing:$("#findUserRule_name").val()};$.ajax({type:"post",url:f,data:JSON.stringify(h),dataType:"json",contentType:"application/json;charset=utf-8",success:function(j){$("#userRule_multiselect").empty();var l=$("#userRule_multiselect");var m="";for(var k=0;k<=j.content.length-1;k++){m+="<option value='"+j.content[k].id+"' ruleCode='"+j.content[k].code+"'>"+j.content[k].name+"</option>"}l.append(m)}});$("#userRule_multiselect").multiselect()})});