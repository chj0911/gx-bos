var saveFoundUser=function(){var $myUserTable=$("#myUserTable");var myAssignId=$("#myAssignId").val();var myAssignType=$("#myAssignType").val();var parentTableId=$("#parentTableId").val();var row=$("#user_multiselect_to option");if(!row||row.length==0){ModalBox.alert("请选择一条数据");return}if($("#findUserCallback").val()){var param=new Array();for(var i=0;i<row.length;i++){var item={value:row[i].value,name:row[i].text};param.push(item)}eval($("#findUserCallback").val()).call(null,param);$("#myAssignModal").modal("hide");return}var userList=new Array();for(var i=0;i<row.length;i++){userList.push(row[i].value)}var param={userNames:userList,id:myAssignId};var url=base+"/admin/usercenter/"+myAssignType+"/saveuser";if(myAssignType=="user"){$("#leaderAccount").val(row[0].value);$("#leaderAccountName").val(row[0].text);$("#myAssignModal").modal("hide");return}else{if(myAssignType=="message"){for(var i=0;i<row.length;i++){var li=$("#addressee-user-"+row[i].value);if(li==undefined||li==""||li.length<1){document.getElementById("addresseeUl").innerHTML+='<li class="search-choice" aname="'+row[i].text+'" atype="USERNAME" addressee="'+row[i].value+'" id="addressee-user-'+row[i].value+'"><span>'+row[i].text+'</span><a class="search-choice-close" onclick="$(this).parent().remove();"></a></li>'}}$("#myAssignModal").modal("hide");return}else{if(myAssignType=="role"){var roleId=$("#roleId-role-assigned").val();$.post(base+"/admin/usercenter/role/create?rolePeople="+userList+"&roleId="+roleId,function(data){if(data.returnObject==true){$("#myAssignModal").modal("hide");$("#"+parentTableId).DataTable().ajax.reload()}});return}else{if(myAssignType=="visitRole"){var roleId=$("#roleId").val();$.post(base+"/admin/signUp/role/create?rolePeople="+userList+"&roleId="+roleId,function(data){if(data.returnObject==true){$("#myAssignModal").modal("hide");$("#"+parentTableId).DataTable().ajax.reload()}});return}else{if(myAssignType=="commentManager"){var personId=$("#user_multiselect_to option").map(function(){return $(this).val()}).get().join(",");var commentManagerId=$("#myAssignId").val();$.ajax({type:"post",url:base+"/admin/coursecenter/coursemanager/commentManager/saveCommentManager?commentManagerId="+commentManagerId+"&userNames="+personId,dataType:"json",contentType:"application/json;charset=utf-8",success:function(response){$("#myAssignModal").modal("hide");var userNames=personId.split(",");var context="";for(var i=0;i<userNames.length;i++){context+='<span class="tag">'+userNames[i]+"<i>X</i>"}$("#typeQuestionAddId").append(context);$("#list-course-list").DataTable().ajax.reload()}});return}}}}}$.ajax({type:"post",url:url,data:JSON.stringify(param),dataType:"json",contentType:"application/json;charset=utf-8",success:function(response){$("#myAssignModal").modal("hide");if(parentTableId){$("#"+parentTableId).DataTable().ajax.reload()}}})};$(function(){var b=$("#myAssignType").val();var a=$("#myUserTable");$("#findUser_search").click(function(){var j=$('div[id="myAssignModal"] div div div div div div div div div[class="panel-collapse collapse in"] div div');if(!j){Modal.alert("请选择左侧体系")}var h=j.jstree().get_selected();var f=j[0].id;var c=$("#user_multiselect_to option");var e=new Array();if(c&&c.length>0){for(var g=0;g<c.length;g++){e.push(c[g].value)}}var d="";if(f=="user_jstree_organization"){d=base+"/admin/usercenter/role/organization/search"}else{if(f=="user_jstree_postTypes"){d=base+"/admin/usercenter/post/user/search"}else{if(f=="user_jstree_group"){d=base+"/admin/usercenter/group/user/search"}}}if(h&&h.length>0){var k={selectId:h[0],relationType:b,relationId:$("#myAssignId").val(),selectedList:e,queryThing:$("#findUser_userName").val()};$.ajax({type:"post",url:d,data:JSON.stringify(k),dataType:"json",contentType:"application/json;charset=utf-8",success:function(l){$("#user_multiselect").empty();var n=$("#user_multiselect");var p="";for(var m=0;m<=l.content.length-1;m++){var o=l.content[m];p+="<option value='"+o.userName+"'>"+o.userRealName+"("+o.userName+")</option>"}n.append(p)}})}});$("#myAssignModal").on("show.bs.modal",function(){$("#user_multiselect").empty();$("#user_multiselect_to").empty();$("#findUser_userName").val("");$.getJSON(base+"/admin/usercenter/role/organization/findAllOrgTypes",function(e){var f=e.returnObject;var d=[];for(var c=0;c<f.length;c++){d.push({id:f[c].oaId,text:f[c].name,data:f[c],parent:(f[c].parentId!=null?f[c].parentId:"#"),state:{opened:f[c].parentId==null}})}$("#user_jstree_organization").jstree({core:{data:d}});$("#user_jstree_organization").on("changed.jstree",function(m,l){var j=base+"/admin/usercenter/role/organization/search";var g=$("#user_multiselect_to option");var h=new Array();if(g&&g.length>0){for(var k=0;k<g.length;k++){h.push(g[k].value)}}var n={selectId:l.node.data.oaId,relationType:b,relationId:$("#myAssignId").val(),selectedList:h,queryThing:$("#findUser_userName").val()};$.ajax({type:"post",url:j,data:JSON.stringify(n),dataType:"json",contentType:"application/json;charset=utf-8",success:function(o){$("#user_multiselect").empty();var q=$("#user_multiselect");var s="";for(var p=0;p<=o.content.length-1;p++){var r=o.content[p];s+="<option value='"+r.userName+"'>"+r.userRealName+"("+r.userName+")</option>"}q.append(s)}})})});$("#user_multiselect").multiselect()})});