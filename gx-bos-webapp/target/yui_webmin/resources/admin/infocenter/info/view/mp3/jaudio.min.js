(function(c){var b="jAudio",d={playlist:[],defaultAlbum:undefined,defaultArtist:undefined,defaultTrack:0,autoPlay:false,debug:false};function a(e,f){this.settings=c.extend(true,d,f);this.$context=e;this.domAudio=this.$context.find("audio")[0];this.$domPlaylist=this.$context.find(".jAudio--playlist");this.$domControls=this.$context.find(".jAudio--controls");this.$domVolumeBar=this.$context.find(".jAudio--volume");this.$domDetails=this.$context.find(".jAudio--details");this.$domStatusBar=this.$context.find(".jAudio--status-bar");this.$domProgressBar=this.$context.find(".jAudio--progress-bar-wrapper");this.$domTime=this.$context.find(".jAudio--time");this.$domElapsedTime=this.$context.find(".jAudio--time-elapsed");this.$domTotalTime=this.$context.find(".jAudio--time-total");this.$domThumb=this.$context.find(".jAudio--thumb");this.currentState="pause";this.currentTrack=this.settings.defaultTrack;this.currentElapsedTime=undefined;this.timer=undefined;this.init()}a.prototype={init:function(){var e=this;e.renderPlaylist();e.preLoadTrack();e.highlightTrack();e.updateTotalTime();e.events();e.debug();e.domAudio.volume=0.05},play:function(){var e=this,f=e.$domControls.find("#btn-play");e.domAudio.play();if(e.currentState==="play"){return}clearInterval(e.timer);e.timer=setInterval(e.run.bind(e),50);e.currentState="play";f.data("action","pause");f.attr("id","btn-pause");f.toggleClass("active")},pause:function(){var e=this,f=e.$domControls.find("#btn-pause");e.domAudio.pause();clearInterval(e.timer);e.currentState="pause";f.data("action","play");f.attr("id","btn-play");f.toggleClass("active")},stop:function(){var e=this;e.domAudio.pause();e.domAudio.currentTime=0;e.animateProgressBarPosition();clearInterval(e.timer);e.updateElapsedTime();e.currentState="stop"},prev:function(){var f=this,e;(f.currentTrack===0)?e=f.settings.playlist.length-1:e=f.currentTrack-1;f.changeTrack(e)},next:function(){var f=this,e;(f.currentTrack===f.settings.playlist.length-1)?e=0:e=f.currentTrack+1;f.changeTrack(e)},preLoadTrack:function(){var f=this,e=f.settings.defaultTrack;f.changeTrack(e);f.stop()},changeTrack:function(f){var e=this;e.currentTrack=f;e.domAudio.src=e.settings.playlist[f].file;if(e.currentState==="play"||e.settings.autoPlay){e.play()}e.highlightTrack();e.updateThumb();e.renderDetails()},events:function(){var e=this;e.$domControls.on("click","button",function(){var f=c(this).data("action");switch(f){case"prev":e.prev.call(e);break;case"next":e.next.call(e);break;case"pause":e.pause.call(e);break;case"stop":e.stop.call(e);break;case"play":e.play.call(e);break}});e.$domPlaylist.on("click",".jAudio--playlist-item",function(i){var h=c(this),f=h.data("track"),g=h.index();if(e.currentTrack===g){return}e.changeTrack(g)});e.$domProgressBar.on("click",function(f){e.updateProgressBar(f);e.updateElapsedTime()});c(e.domAudio).on("loadedmetadata",function(){e.animateProgressBarPosition.call(e);e.updateElapsedTime.call(e);e.updateTotalTime.call(e)})},getAudioSeconds:function(f){var e=this,f=f%60;f=e.addZero(Math.floor(f),2);(f<60)?f=f:f="00";return f},getAudioMinutes:function(f){var e=this,f=f/60;f=e.addZero(Math.floor(f),2);(f<60)?f=f:f="00";return f},addZero:function(f,e){var f=String(f);while(f.length<e){f="0"+f}return f},removeZero:function(g,e){var g=String(g),f=0;while(f<e){if(g[0]==="0"){g=g.substr(1,g.length)}else{break}f++}return g},highlightTrack:function(){var e=this,f=e.$domPlaylist.children(),g="active";f.removeClass(g);f.eq(e.currentTrack).addClass(g)},renderDetails:function(){var g=this,e=g.settings.playlist[g.currentTrack],i=e.file,f=e.thumb,h=e.trackName,k=e.trackArtist,l=e.trackAlbum,j="";j+="<p>";j+="<span>"+h+"</span>";j+="<span>"+k+"</span>";j+="</p>";c(".jAudio--details").html(j)},renderPlaylist:function(){var e=this,f="";c.each(e.settings.playlist,function(l,g){var k=g.file,h=g.thumb,j=g.trackName,m=g.trackArtist,n=g.trackAlbum;trackDuration="00:00";f+="<div class='jAudio--playlist-item' data-track='"+k+"'>";f+="<div class='jAudio--playlist-thumb'><img src='"+h+"'></div>";f+="<div class='jAudio--playlist-meta-text'>";f+="<h4>"+j+"</h4>";f+="<p>"+m+"</p>";f+="</div>";f+="</div>"});e.$domPlaylist.html(f)},run:function(){var e=this;e.animateProgressBarPosition();e.updateElapsedTime();if(e.domAudio.ended){e.next()}},animateProgressBarPosition:function(){var f=this,e=(f.domAudio.currentTime*100/f.domAudio.duration)+"%",g={width:e};f.$domProgressBar.children().eq(0).css(g)},updateProgressBar:function(j){var g=this,h,f,i;if(j.offsetX){h=j.offsetX}if(h===undefined&&j.layerX){h=j.layerX}f=h/g.$domProgressBar.width();i=g.domAudio.duration*f;g.domAudio.currentTime=i;g.animateProgressBarPosition()},updateElapsedTime:function(){var e=this,h=e.domAudio.currentTime,g=e.getAudioMinutes(h),i=e.getAudioSeconds(h),f=g+":"+i;e.$domElapsedTime.text(f)},updateTotalTime:function(){var e=this,h=e.domAudio.duration,g=e.getAudioMinutes(h),i=e.getAudioSeconds(h),f=g+":"+i;e.$domTotalTime.text(f)},updateThumb:function(){var f=this,e=f.settings.playlist[f.currentTrack].thumb,g={"background-image":"url("+e+")"};f.$domThumb.css(g)},debug:function(){var e=this;if(e.settings.debug){console.log(e.settings)}}};c.fn[b]=function(f){var e=function(){return new a(c(this),f)};c(this).each(e)}})(jQuery);