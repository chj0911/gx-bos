(function(e,a,c,h,f){var g={};function b(i){return c.translate(i)||i}function d(i){i.id=i.attr("id");i.html('<div class="plupload_wrapper"><div class="ui-widget-content plupload_container"><div class="ui-state-default ui-widget-header plupload_header"><div class="plupload_header_content"><div class="plupload_logo"> </div><div class="plupload_header_title">'+b("Select files")+'</div><div class="plupload_header_text">'+b("Add files to the upload queue and click the start button.")+'</div><div class="plupload_view_switch"><input type="radio" id="'+i.id+'_view_list" name="view_mode_'+i.id+'" checked="checked" /><label class="plupload_button" for="'+i.id+'_view_list" data-view="list">'+b("List")+'</label><input type="radio" id="'+i.id+'_view_thumbs" name="view_mode_'+i.id+'" /><label class="plupload_button"  for="'+i.id+'_view_thumbs" data-view="thumbs">'+b("Thumbnails")+'</label></div></div></div><table class="plupload_filelist plupload_filelist_header ui-widget-header"><tr><td class="plupload_cell plupload_file_name">'+b("Filename")+'</td><td class="plupload_cell plupload_file_status">'+b("Status")+'</td><td class="plupload_cell plupload_file_size">'+b("Size")+'</td><td class="plupload_cell plupload_file_action">&nbsp;</td></tr></table><div class="plupload_content"><div class="plupload_droptext">'+b("Drag files here.")+'</div><ul class="plupload_filelist_content"> </ul><div class="plupload_clearer">&nbsp;</div></div><table class="plupload_filelist plupload_filelist_footer ui-widget-header"><tr><td class="plupload_cell plupload_file_name"><div class="plupload_buttons"><!-- Visible --><a class="plupload_button plupload_add">'+b("Add Files")+'</a>&nbsp;<a class="plupload_button plupload_start">'+b("Start Upload")+'</a>&nbsp;<a class="plupload_button plupload_stop plupload_hidden">'+b("Stop Upload")+'</a>&nbsp;</div><div class="plupload_started plupload_hidden"><!-- Hidden --><div class="plupload_progress plupload_right"><div class="plupload_progress_container"></div></div><div class="plupload_cell plupload_upload_status"></div><div class="plupload_clearer">&nbsp;</div></div></td><td class="plupload_file_status"><span class="plupload_total_status">0%</span></td><td class="plupload_file_size"><span class="plupload_total_file_size">0 kb</span></td><td class="plupload_file_action"></td></tr></table></div><input class="plupload_count" value="0" type="hidden"></div>')}f.widget("ui.plupload",{widgetEventPrefix:"",contents_bak:"",options:{browse_button_hover:"ui-state-hover",browse_button_active:"ui-state-active",filters:{},buttons:{browse:true,start:true,stop:true},views:{list:true,thumbs:false,active:"list",remember:true},thumb_width:100,thumb_height:60,multiple_queues:true,dragdrop:true,autostart:false,sortable:false,rename:false},FILE_COUNT_ERROR:-9001,_create:function(){var i=this.element.attr("id");if(!i){i=c.guid();this.element.attr("id",i)}this.id=i;this.contents_bak=this.element.html();d(this.element);this.container=f(".plupload_container",this.element).attr("id",i+"_container");this.content=f(".plupload_content",this.element);if(f.fn.resizable){this.container.resizable({handles:"s",minHeight:300})}this.filelist=f(".plupload_filelist_content",this.container).attr({id:i+"_filelist",unselectable:"on"});this.browse_button=f(".plupload_add",this.container).attr("id",i+"_browse");this.start_button=f(".plupload_start",this.container).attr("id",i+"_start");this.stop_button=f(".plupload_stop",this.container).attr("id",i+"_stop");this.thumbs_switcher=f("#"+i+"_view_thumbs");this.list_switcher=f("#"+i+"_view_list");if(f.ui.button){this.browse_button.button({icons:{primary:"ui-icon-circle-plus"},disabled:true});this.start_button.button({icons:{primary:"ui-icon-circle-arrow-e"},disabled:true});this.stop_button.button({icons:{primary:"ui-icon-circle-close"}});this.list_switcher.button({text:false,icons:{secondary:"ui-icon-grip-dotted-horizontal"}});this.thumbs_switcher.button({text:false,icons:{secondary:"ui-icon-image"}})}this.progressbar=f(".plupload_progress_container",this.container);if(f.ui.progressbar){this.progressbar.progressbar()}this.counter=f(".plupload_count",this.element).attr({id:i+"_count",name:i+"_count"});this._initUploader()},_initUploader:function(){var i=this,l=this.id,k,j={container:l+"_buttons",browse_button:l+"_browse"};f(".plupload_buttons",this.element).attr("id",l+"_buttons");if(i.options.dragdrop){this.filelist.parent().attr("id",this.id+"_dropbox");j.drop_element=this.id+"_dropbox"}this.filelist.on("click",function(m){if(f(m.target).hasClass("plupload_action_icon")){i.removeFile(f(m.target).closest(".plupload_file").attr("id"));m.preventDefault()}});k=this.uploader=g[l]=new c.Uploader(f.extend(this.options,j));if(i.options.views.thumbs){k.settings.required_features.display_media=true}if(i.options.max_file_count){c.extend(k.getOption("filters"),{max_file_count:i.options.max_file_count})}c.addFileFilter("max_file_count",function(o,n,m){if(o<=this.files.length-(this.total.uploaded+this.total.failed)){i.browse_button.button("disable");this.disableBrowse();this.trigger("Error",{code:i.FILE_COUNT_ERROR,message:b("File count error."),file:n});m(false)}else{m(true)}});k.bind("Error",function(m,p){var o,n="";o="<strong>"+p.message+"</strong>";switch(p.code){case c.FILE_EXTENSION_ERROR:n=h.sprintf(b("File: %s"),p.file.name);break;case c.FILE_SIZE_ERROR:n=h.sprintf(b("File: %s, size: %d, max file size: %d"),p.file.name,c.formatSize(p.file.size),c.formatSize(c.parseSize(m.getOption("filters").max_file_size)));break;case c.FILE_DUPLICATE_ERROR:n=h.sprintf(b("%s already present in the queue."),p.file.name);break;case i.FILE_COUNT_ERROR:n=h.sprintf(b("Upload element accepts only %d file(s) at a time. Extra files were stripped."),m.getOption("filters").max_file_count||0);break;case c.IMAGE_FORMAT_ERROR:n=b("Image format either wrong or not supported.");break;case c.IMAGE_MEMORY_ERROR:n=b("Runtime ran out of available memory.");break;case c.HTTP_ERROR:n=b("Upload URL might be wrong or doesn't exist.");break}o+=" <br /><i>"+n+"</i>";i._trigger("error",null,{up:m,error:p});if(p.code===c.INIT_ERROR){setTimeout(function(){i.destroy()},1)}else{i.notify("error",o)}});k.bind("PostInit",function(m){if(!i.options.buttons.browse){i.browse_button.button("disable").hide();m.disableBrowse(true)}else{i.browse_button.button("enable")}if(!i.options.buttons.start){i.start_button.button("disable").hide()}if(!i.options.buttons.stop){i.stop_button.button("disable").hide()}if(!i.options.unique_names&&i.options.rename){i._enableRenaming()}if(i.options.dragdrop&&m.features.dragdrop){i.filelist.parent().addClass("plupload_dropbox")}i._enableViewSwitcher();i.start_button.click(function(n){if(!f(this).button("option","disabled")){i.start()}n.preventDefault()});i.stop_button.click(function(n){i.stop();n.preventDefault()});i._trigger("ready",null,{up:m})});k.init();k.bind("FileFiltered",function(m,n){i._addFiles(n)});k.bind("FilesAdded",function(m,n){i._trigger("selected",null,{up:m,files:n});if(i.options.sortable&&f.ui.sortable){i._enableSortingList()}i._trigger("updatelist",null,{filelist:i.filelist});if(i.options.autostart){setTimeout(function(){i.start()},10)}});k.bind("FilesRemoved",function(m,n){if(f.ui.sortable&&i.options.sortable){f("tbody",i.filelist).sortable("destroy")}f.each(n,function(p,o){f("#"+o.id).toggle("highlight",function(){f(this).remove()})});if(m.files.length){if(i.options.sortable&&f.ui.sortable){i._enableSortingList()}}i._trigger("updatelist",null,{filelist:i.filelist});i._trigger("removed",null,{up:m,files:n})});k.bind("QueueChanged StateChanged",function(){i._handleState()});k.bind("UploadFile",function(m,n){i._handleFileStatus(n)});k.bind("FileUploaded",function(m,n){i._handleFileStatus(n);i._trigger("uploaded",null,{up:m,file:n})});k.bind("UploadProgress",function(m,n){i._handleFileStatus(n);i._updateTotalProgress();i._trigger("progress",null,{up:m,file:n})});k.bind("UploadComplete",function(m,n){i._addFormFields();i._trigger("complete",null,{up:m,files:n})})},_setOption:function(j,k){var i=this;if(j=="buttons"&&typeof(k)=="object"){k=f.extend(i.options.buttons,k);if(!k.browse){i.browse_button.button("disable").hide();i.uploader.disableBrowse(true)}else{i.browse_button.button("enable").show();i.uploader.disableBrowse(false)}if(!k.start){i.start_button.button("disable").hide()}else{i.start_button.button("enable").show()}if(!k.stop){i.stop_button.button("disable").hide()}else{i.start_button.button("enable").show()}}i.uploader.settings[j]=k},start:function(){this.uploader.start();this._trigger("start",null,{up:this.uploader})},stop:function(){this.uploader.stop();this._trigger("stop",null,{up:this.uploader})},enable:function(){this.browse_button.button("enable");this.uploader.disableBrowse(false)},disable:function(){this.browse_button.button("disable");this.uploader.disableBrowse(true)},getFile:function(j){var i;if(typeof j==="number"){i=this.uploader.files[j]}else{i=this.uploader.getFile(j)}return i},getFiles:function(){return this.uploader.files},removeFile:function(i){if(c.typeOf(i)==="string"){i=this.getFile(i)}this.uploader.removeFile(i)},clearQueue:function(){this.uploader.splice()},getUploader:function(){return this.uploader},refresh:function(){this.uploader.refresh()},notify:function(j,k){var i=f('<div class="plupload_message"><span class="plupload_message_close ui-icon ui-icon-circle-close" title="'+b("Close")+'"></span><p><span class="ui-icon"></span>'+k+"</p></div>");i.addClass("ui-state-"+(j==="error"?"error":"highlight")).find("p .ui-icon").addClass("ui-icon-"+(j==="error"?"alert":"info")).end().find(".plupload_message_close").click(function(){i.remove()}).end();f(".plupload_header",this.container).append(i)},destroy:function(){this.uploader.destroy();f(".plupload_button",this.element).unbind();if(f.ui.button){f(".plupload_add, .plupload_start, .plupload_stop",this.container).button("destroy")}if(f.ui.progressbar){this.progressbar.progressbar("destroy")}if(f.ui.sortable&&this.options.sortable){f("tbody",this.filelist).sortable("destroy")}this.element.empty().html(this.contents_bak);this.contents_bak="";f.Widget.prototype.destroy.apply(this)},_handleState:function(){var i=this.uploader,j=i.files.length-(i.total.uploaded+i.total.failed),k=i.getOption("filters").max_file_count||0;if(c.STARTED===i.state){f([]).add(this.stop_button).add(".plupload_started").removeClass("plupload_hidden");this.start_button.button("disable");if(!this.options.multiple_queues){this.browse_button.button("disable");i.disableBrowse()}f(".plupload_upload_status",this.element).html(h.sprintf(b("Uploaded %d/%d files"),i.total.uploaded,i.files.length));f(".plupload_header_content",this.element).addClass("plupload_header_content_bw")}else{if(c.STOPPED===i.state){f([]).add(this.stop_button).add(".plupload_started").addClass("plupload_hidden");if(j){this.start_button.button("enable")}else{this.start_button.button("disable")}if(this.options.multiple_queues){f(".plupload_header_content",this.element).removeClass("plupload_header_content_bw")}if(this.options.multiple_queues&&k&&k>j){this.browse_button.button("enable");i.disableBrowse(false)}this._updateTotalProgress()}}if(i.total.queued===0){f(".ui-button-text",this.browse_button).html(b("Add Files"))}else{f(".ui-button-text",this.browse_button).html(h.sprintf(b("%d files queued"),i.total.queued))}i.refresh()},_handleFileStatus:function(m){var k=f("#"+m.id),o,j;if(!k.length){return}switch(m.status){case c.DONE:o="plupload_done";j="plupload_action_icon ui-icon ui-icon-circle-check";break;case c.FAILED:o="ui-state-error plupload_failed";j="plupload_action_icon ui-icon ui-icon-alert";break;case c.QUEUED:o="plupload_delete";j="plupload_action_icon ui-icon ui-icon-circle-minus";break;case c.UPLOADING:o="ui-state-highlight plupload_uploading";j="plupload_action_icon ui-icon ui-icon-circle-arrow-w";var i=f(".plupload_scroll",this.container),n=i.scrollTop(),p=i.height(),l=k.position().top+k.height();if(p<l){i.scrollTop(n+l-p)}k.find(".plupload_file_percent").html(m.percent+"%").end().find(".plupload_file_progress").css("width",m.percent+"%").end().find(".plupload_file_size").html(c.formatSize(m.size));break}o+=" ui-state-default plupload_file";k.attr("class",o).find(".plupload_action_icon").attr("class",j)},_updateTotalProgress:function(){var i=this.uploader;this.filelist[0].scrollTop=this.filelist[0].scrollHeight;this.progressbar.progressbar("value",i.total.percent);this.element.find(".plupload_total_status").html(i.total.percent+"%").end().find(".plupload_total_file_size").html(c.formatSize(i.total.size)).end().find(".plupload_upload_status").html(h.sprintf(b("Uploaded %d/%d files"),i.total.uploaded,i.files.length))},_displayThumbs:function(){var v=this,o,j,t,n=0,q=[],l=false;if(!this.options.views.thumbs){return}function s(y,x,w){var z;y.on(x,function(){clearTimeout(z);z=setTimeout(function(){clearTimeout(z);w()},300)})}function i(){if(!o||!j){var y=f(".plupload_file:eq(0)",v.filelist);o=y.outerWidth(true);j=y.outerHeight(true)}var x=v.content.width(),w=v.content.height();t=Math.floor(x/o);n=t*(Math.ceil(w/j)+1)}function k(){var w=Math.floor(v.content.scrollTop()/j)*t;q=f(".plupload_file",v.filelist).slice(w,w+n).filter(".plupload_file_loading").get()}function u(){function w(){if(v.view_mode!=="thumbs"){return}i();k();m()}if(f.fn.resizable){s(v.container,"resize",w)}s(v.window,"resize",w);s(v.content,"scroll",w);v.element.on("viewchanged selected",w);w()}function r(y,w){var x=new h.Image();x.onload=function(){var z=f("#"+y.id+" .plupload_file_thumb",v.filelist).html("");this.embed(z[0],{width:v.options.thumb_width,height:v.options.thumb_height,crop:true,swf_url:h.resolveUrl(v.options.flash_swf_url),xap_url:h.resolveUrl(v.options.silverlight_xap_url)})};x.bind("embedded error",function(){f("#"+y.id,v.filelist).removeClass("plupload_file_loading");this.destroy();setTimeout(w,1)});x.load(y.getSource())}function m(){if(v.view_mode!=="thumbs"||l){return}k();if(!q.length){return}l=true;r(v.getFile(f(q.shift()).attr("id")),function(){l=false;m()})}this.element.on("selected",function p(){v.element.off("selected",p);u()})},_addFiles:function(l){var j=this,i,k="";i='<li class="plupload_file ui-state-default plupload_file_loading plupload_delete" id="%id%" style="width:%thumb_width%px;"><div class="plupload_file_thumb" style="width:%thumb_width%px;height:%thumb_height%px;"><div class="plupload_file_dummy ui-widget-content" style="line-height:%thumb_height%px;"><span class="ui-state-disabled">%ext% </span></div></div><div class="plupload_file_status"><div class="plupload_file_progress ui-widget-header" style="width: 0%"> </div><span class="plupload_file_percent">%percent% </span></div><div class="plupload_file_name" title="%name%"><span class="plupload_file_name_wrapper">%name% </span></div><div class="plupload_file_action"><div class="plupload_action_icon ui-icon ui-icon-circle-minus"> </div></div><div class="plupload_file_size">%size% </div><div class="plupload_file_fields"> </div></li>';if(c.typeOf(l)!=="array"){l=[l]}f.each(l,function(n,m){var o=h.Mime.getFileExtension(m.name)||"none";k+=i.replace(/%(\w+)%/g,function(q,p){switch(p){case"thumb_width":case"thumb_height":return j.options[p];case"size":return c.formatSize(m.size);case"ext":return o;default:return m[p]||""}})});j.filelist.append(k)},_addFormFields:function(){var i=this;f(".plupload_file_fields",this.filelist).html("");c.each(this.uploader.files,function(k,l){var j="",m=i.id+"_"+l;if(k.target_name){j+='<input type="hidden" name="'+m+'_tmpname" value="'+c.xmlEncode(k.target_name)+'" />'}j+='<input type="hidden" name="'+m+'_name" value="'+c.xmlEncode(k.name)+'" />';j+='<input type="hidden" name="'+m+'_status" value="'+(k.status===c.DONE?"done":"failed")+'" />';f("#"+k.id).find(".plupload_file_fields").html(j)});this.counter.val(this.uploader.files.length)},_viewChanged:function(i){if(this.options.views.remember&&f.cookie){f.cookie("plupload_ui_view",i,{expires:7,path:"/"})}if(h.Env.browser==="IE"&&h.Env.version<7){this.content.attr("style",'height:expression(document.getElementById("'+this.id+'_container").clientHeight - '+(i==="list"?132:102)+")")}this.container.removeClass("plupload_view_list plupload_view_thumbs").addClass("plupload_view_"+i);this.view_mode=i;this._trigger("viewchanged",null,{view:i})},_enableViewSwitcher:function(){var j=this,i,m=f(".plupload_view_switch",this.container),l,k;c.each(["list","thumbs"],function(n){if(!j.options.views[n]){m.find('[for="'+j.id+"_view_"+n+'"], #'+j.id+"_view_"+n).remove()}});l=m.find(".plupload_button");if(l.length===1){m.hide();i=l.eq(0).data("view");this._viewChanged(i)}else{if(f.ui.button&&l.length>1){if(this.options.views.remember&&f.cookie){i=f.cookie("plupload_ui_view")}if(!~c.inArray(i,["list","thumbs"])){i=this.options.views.active}m.show().buttonset().find(".ui-button").click(function(n){i=f(this).data("view");j._viewChanged(i);n.preventDefault()});k=m.find('[for="'+j.id+"_view_"+i+'"]');if(k.length){k.trigger("click")}}else{m.show();this._viewChanged(this.options.views.active)}}if(this.options.views.thumbs){this._displayThumbs()}},_enableRenaming:function(){var i=this;this.filelist.dblclick(function(p){var n=f(p.target),m,k,o,j,l="";if(!n.hasClass("plupload_file_name_wrapper")){return}k=i.uploader.getFile(n.closest(".plupload_file")[0].id);j=k.name;o=/^(.+)(\.[^.]+)$/.exec(j);if(o){j=o[1];l=o[2]}m=f('<input class="plupload_file_rename" type="text" />').width(n.width()).insertAfter(n.hide());m.val(j).blur(function(){n.show().parent().scrollLeft(0).end().next().remove()}).keydown(function(r){var q=f(this);if(f.inArray(r.keyCode,[13,27])!==-1){r.preventDefault();if(r.keyCode===13){k.name=q.val()+l;n.html(k.name)}q.blur()}})[0].focus()})},_enableSortingList:function(){var i=this;if(f(".plupload_file",this.filelist).length<2){return}f("tbody",this.filelist).sortable("destroy");this.filelist.sortable({items:".plupload_delete",cancel:"object, .plupload_clearer",stop:function(){var j=[];f.each(f(this).sortable("toArray"),function(k,l){j[j.length]=i.uploader.getFile(l)});j.unshift(j.length);j.unshift(0);Array.prototype.splice.apply(i.uploader.files,j)}})}})}(window,document,plupload,mOxie,jQuery));