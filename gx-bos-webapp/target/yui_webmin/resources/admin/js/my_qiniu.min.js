var Qiniu_uploader=function(f){var b=f.documentId;var e=f.token;var l=f.key,i=f.keyId;var g=f.proDivId,k=f.proId,j=f.proPercentId;var h="https://up.qbox.me";var m=new XMLHttpRequest();m.open("POST",h,true);var c,a;c=new FormData();if(l!==null&&l!==undefined){c.append("key",l)}c.append("token",e);c.append("file",$("#"+b)[0].files[0]);var d;m.upload.addEventListener("progress",function(p){if(p.lengthComputable){var q=new Date().getTime();d=q-a;var o=(p.loaded)/1024;var t=d/1000;var r=(o/t);var n;if(r>1024){n=(r/1024).toFixed(2)+"Mb/s"}else{n=r.toFixed(2)+"Kb/s"}var s=Math.round(p.loaded*100/p.total);$("#"+g).show();$("#"+k).css("width",s+"%");$("#"+j).html(s+"%")}},false);m.onreadystatechange=function(n){if(m.readyState==4&&m.status==200&&m.responseText!=""){var o=JSON.parse(m.responseText);$("#"+i).val(o.key);$("#"+g).css("display","none")}else{if(m.status!=200&&m.responseText){$("#proPercent").html(0+"%  上传失败！");setTimeout("$('#'+ pro).css('width',0+'%');",1000);setTimeout("$('#'+ proDiv).hide();",2000);$("#"+b).val("")}}};a=new Date().getTime();m.send(c)};