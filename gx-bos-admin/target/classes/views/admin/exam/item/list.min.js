var ItemList=(function(f){var a="item-list";var q="#list-"+a;var d="#form-"+a;var h=f(q);var l;var g=function(){h.treetable("getPersistedTreeState")};var p=ko.mapping.fromJS({selectedRow:null});p.onAddEnable=ko.dependentObservable(function(){var s=p.selectedRow();return s!=null});var m=function(){f("#select-all-"+a).click(function(){var s=f(q+" tr");for(var t=0;t<s.length;t++){if(s[t].id!="undefined"&&s[t].id!=""){if(!f(q+" tr[id="+s[t].id+"]").hasClass("selected")){selectAll=false}}}if(selectAll){h.DataTable().rows(".selected").deselect();selectAll=false;f(q+" tr").each(function(){f(this).removeClass("selected")});p.selectedRow(null)}else{for(var t=0;t<s.length;t++){if(s[t].id!="undefined"&&s[t].id!=""){f(q+" tr[id="+s[t].id+"]").addClass("selected")}}h.DataTable().rows(".selected").select();p.selectedRow(h.DataTable().rows(".selected").data());selectAll=true}})};var k=function(){f("#add-action-"+a).click(function(s){f(this).trigger({type:"push.mu.breadcrumb",page:base+"/admin/exam/item/createUI"})})};var r=function(){f("#edit-action-"+a).click(function(s){var t=p.selectedRow();f(this).trigger({type:"push.mu.breadcrumb",page:base+"/admin/exam/item/edit/"+t[0].id})})};var b=function(){f("#questionBank-action-"+a).click(function(s){f(this).trigger({type:"push.mu.breadcrumb",page:base+"/admin/exam/item/questionBank"})})};var n=function(){f("#recycled-action-"+a).click(function(){var v=f(q).DataTable().selectedRowIds();var u=f(q).DataTable().selectedRows();var t="";for(var s=0;s<u.length;s++){if(s==0){t+=u[s].id}else{t+=","+u[s].id}}ModalBox.confirm("您确定要把这【"+v.length+"】道题放入回收站吗？",function(w){if(w){f.post(base+"/admin/exam/item/recycled/"+t,function(x){if(x.returnObject){MessageBox.info("放入回收站成功.");h.DataTable().rows({selected:true}).clear();p.selectedRow(null);f(q).DataTable().ajax.reload()}else{MessageBox.info("放入回收站失败.");h.DataTable().rows({selected:true}).clear();p.selectedRow(null);f(q).DataTable().ajax.reload()}})}})})};var j=function(){f("#back-action-"+a).click(function(s){f(this).trigger({type:"push.mu.breadcrumb",page:base+"/admin/exam/item/recycled"})})};var c=function(){f("#export-action-"+a).click(function(x){var t=f("form div div div div div input");var s="place=0";for(var v=0;v<t.length;v++){s+="&"+t[v].id+"="+encodeURI(encodeURI(t[v].value.trim()))}var w=f("#type").val();s+="&type="+w;var u=base+"/admin/exam/item/export?"+s;window.location.href=u})};var e=function(){f("#input-action-"+a).click(function(s){f(this).trigger({type:"push.mu.breadcrumb",page:base+"/admin/exam/item/itemInput"})})};var i=function(){f("#search-action-"+a).click(function(){var t=f("form div div div div div input");var s;for(var v=0;v<t.length;v++){if(v==0){s=t[v].id+"="+t[v].value.trim()}else{s+="&ch_"+t[v].id+"="+encodeURI(encodeURI(t[v].value.trim()))}}var w=f("#type").val();s+="&type="+w;var u=base+"/admin/exam/item/search?"+s;h.DataTable().rows({selected:true}).clear();f(q).DataTable().ajax.url(u).load();p.selectedRow(null)})};var o=function(){f(q).on("click","tbody",function(t,s){p.selectedRow(h.DataTable().rows({selected:true}).data());return true})};return{reloadItemBaseTree:function(){f.getJSON(base+"/admin/exam/item/findItemBase",function(v){var s=v.returnObject;var u=new Array();for(var t=0;t<s.length;t++){u.push({id:s[t].id,text:s[t].baseName,data:s[t],parent:(s[t].parentId?s[t].parentId:"#")})}f("#jstree_userOrganization").data("jstree",false).empty().jstree({core:{data:u}});f("#jstree_userOrganization").on("loaded.jstree",function(x,w){f("#jstree_userOrganization").jstree("open_all")});f("#jstree_userOrganization").on("changed.jstree",function(x,w){if(w.node){f("#baseId").val(w.node.data.id);f("#search-action-"+a).click()}})})},init:function(){m();k();i();r();b();n();j();e();c();o();p.onAddEnable=ko.dependentObservable(function(){return true});p.onEdiEnable=ko.dependentObservable(function(){return false});p.onEditEnable=ko.dependentObservable(function(){var s=p.selectedRow();return(s&&s.length>0&&s.length<2)});p.onRecycledEnable=ko.dependentObservable(function(){var s=p.selectedRow();return(s&&s.length>0)});p.onBackEnable=ko.dependentObservable(function(){return true});p.onQuestionBankEnable=ko.dependentObservable(function(){return true});p.onImportEnable=ko.dependentObservable(function(){return true});p.onExportEnable=ko.dependentObservable(function(){return true});ko.applyBindings(p);this.reloadItemBaseTree()},type:function(u,t,s,v){if(u=="SINGLE"){return"单选题"}else{if(u=="MULTIPLE"){return"多选题"}else{if(u=="JUDGMENT"){return"判断题"}else{if(u=="FILL"){return"填空题"}else{if(u=="QUESTIONS"){return"问答题"}else{if(u=="ASCERTAIN"){return"判断改错"}else{return u}}}}}}},source:function(u,t,s,v){if(u=="EXPIRED"){return"自动过期"}else{if(u=="MANUAL"){return"手动删除"}else{return u}}},orgJstreeCallback:function(s,v){var t=[],u;l=v;if(v!=null&&v.length){f.each(v,function(w,x){if(typeof x.id=="undefined"){return true}u={id:x.id,parent:!x.pid?"#":x.pid,text:x.label,state:{disabled:!!x.isgroup}};t.push(u)})}return t},xhrComplete:function(s){if(s.success){s.content.makeLineTree({pid:"parentId",order:"id"})}},formatName:function(v,t,s,w,u){if(v!=null&&v!=undefined){f(u).attr("title",v);if(v.length>20){return"<a href='javascript:void(0)' onclick='ItemList.detailAction("+s.id+")'><font color='blue'><label title='"+v+"'>"+v.substring(0,20)+"...</label></font></a>"}else{return"<a href='javascript:void(0)' onclick='ItemList.detailAction("+s.id+")'><font color='blue'><label title='"+v+"'>"+v+"</label></font></a>"}}},detailAction:function(s){f("#hide-action-"+a).trigger({type:"push.mu.breadcrumb",page:base+"/admin/exam/item/detailUI?id="+s})},delFile:function(s){ModalBox.confirm("是否确定删除？",function(t){if(t){f(s).parent().parent().remove();var u=f(s).parent().find("label").attr("name");if(u!=undefined){f("#"+u).remove()}}})}}}(jQuery));$(function(){ItemList.init()});document.onkeydown=function(a){var b=a||window.event||arguments.callee.caller.arguments[0];if(b&&b.keyCode==13){document.getElementById("search-action-item-list").click()}};